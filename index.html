<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SMART AI SCHEDULER 24H</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root {
            --bg-dark: #0a0a0a; --accent-blue: #0070FF; --text-silver: #f5f5f5;
            --metal-gradient: linear-gradient(145deg, #444444, #222222);
            --location-color: #E0E0E0; --ai-orange: #FF9500;
        }
        body { background-color: var(--bg-dark); color: var(--text-silver); font-family: 'Segoe UI', 'Malgun Gothic', sans-serif; margin: 0; padding: 5px; display: flex; flex-direction: column; height: 100vh; overflow: hidden; box-sizing: border-box; }
        
        .header-container { text-align: center; padding: 12px 0; background: linear-gradient(145deg, #1a1a1a, #000000); border-bottom: 1px solid #333; flex-shrink: 0; position: relative; }
        #copy-status-bar { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--ai-orange); color: #000; font-weight: 900; align-items: center; justify-content: center; z-index: 100; font-size: 0.95rem; cursor: pointer; }

        .header-title { font-size: 1.6rem; font-weight: 800; color: #fff; letter-spacing: 2px; margin: 0; text-transform: uppercase; }
        .nav-container { display: flex; justify-content: center; align-items: center; gap: 25px; margin-top: 8px; }
        .nav-btn { background: var(--metal-gradient); color: #fff; border: 1px solid #555; border-radius: 6px; padding: 4px 12px; cursor: pointer; }
        
        .calendar-container { flex: 1; margin-top: 5px; display: flex; flex-direction: column; background: #000; border: 1px solid #222; overflow: hidden; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); height: 100%; gap: 1px; background: #222; }
        .cal-header { color: #888; font-weight: 800; padding: 4px 0; text-align: center; font-size: 0.7rem; background: #111; line-height: 1; }

        .cal-day { background: #0a0a0a; padding: 5px; cursor: pointer; display: flex; flex-direction: column; position: relative; min-height: 0; overflow: hidden; transition: 0.2s; }
        .cal-day:active { background: #1a1a1a; }
        .cal-day.prev-month, .cal-day.next-month { opacity: 0; pointer-events: none; }
        
        .day-num { font-size: 1.1rem; font-weight: 800; color: #fff; position: absolute; top: 5px; left: 8px; z-index: 2; }
        .weather-badge-main { align-self: flex-end; text-align: right; font-size: 1.0rem; line-height: 1.2; font-weight: 900; z-index: 2; }
        .w-line { display: flex; justify-content: flex-end; align-items: center; white-space: nowrap; height: 1.2rem; } 
        .w-loc-inline { color: var(--location-color); font-size: 0.85rem; font-weight: 900; margin-right: 5px; opacity: 0.8; }

        /* [ë³€ê²½] íƒ€ì„ë°” 24ê°œë¡œ í™•ì¥ */
        .time-bar { display: grid; grid-template-columns: repeat(24, 1fr); gap: 0.5px; height: 10px; background: #151515; margin-top: auto; border-radius: 1px; border: 1px solid #222; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: #111; width: 95%; max-width: 480px; padding: 12px; border: 1px solid #333; border-radius: 12px; }

        .ai-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 3000; justify-content: center; align-items: center; }
        .ai-content { background: #111; width: 90%; max-width: 400px; padding: 20px; border: 2px solid var(--ai-orange); border-radius: 15px; }

        .f-btn { flex: 1; border-radius: 6px; font-size: 0.7rem; font-weight: 900; border: 1px solid #444; cursor: pointer; background: var(--metal-gradient); color: #fff; }
        .m-btn { background: var(--metal-gradient); color: white; height: 44px; border-radius: 8px; border: 1px solid #444; cursor: pointer; font-weight: 800; }
        
        /* [ë³€ê²½] ì‹œê°„ ì„ íƒê¸° 24ê°œ ë°°ì¹˜ */
        #time-picker { display: grid; grid-template-columns: repeat(12, 1fr); gap: 3px; margin-bottom: 8px; background: #000; padding: 4px; border-radius: 6px; }

        .stamp-mode-active { cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='48' height='48' viewBox='0 0 48 48'><text y='20' font-size='20'>ğŸ’°</text></svg>") 10 10, cell !important; }
        #map-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.98); z-index:2000; flex-direction:column; padding:15px; }
        #map-container { width:100%; flex:1; border-radius:12px; }
    </style>
</head>
<body id="main-body">

    <div class="header-container">
        <div id="copy-status-bar" onclick="deactivateStampMode()">[ğŸ’°ìŠ¤íƒ¬í”„ ëª¨ë“œ í™œì„±] ë‹¬ë ¥ì„ í´ë¦­í•´ ì°ìœ¼ì„¸ìš”. (ì¢…ë£Œ: ESC)</div>
        <div class="header-title">SMART SCHEDULER 24H</div>
        <div class="nav-container">
            <button class="nav-btn" onclick="changeMonth(-1)">PREV</button>
            <div id="year-title" style="color:var(--accent-blue); font-weight:bold; font-size:1.3rem; min-width:130px; text-align:center;"></div>
            <button class="nav-btn" onclick="changeMonth(1)">NEXT</button>
        </div>
    </div>

    <div class="calendar-container" id="calendar-box"><div id="main-calendar" class="cal-grid"></div></div>

    <div id="ai-modal" class="ai-modal">
        <div class="ai-content">
            <h3 style="color:var(--ai-orange); margin-top:0;">ğŸ¤– AI ì§€ëŠ¥í˜• ë¹„ì„œ (24H ì—”ì§„)</h3>
            <textarea id="ai-command" style="width:100%; background:#000; border:1px solid #333; color:#fff; padding:12px; border-radius:8px; margin-bottom:15px; box-sizing:border-box;" rows="4" placeholder="ì˜ˆ: ë§¤ì£¼ ê¸ˆìš”ì¼ í´ë˜ì‹ê¸°íƒ€ ë ˆìŠ¨ ì˜¤ì „10ì‹œë¶€í„° ì˜¤í›„1ì‹œê¹Œì§€"></textarea>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button class="m-btn" onclick="processAICommand()" style="background:var(--ai-orange); color:#000;">ëª…ë ¹ ì‹¤í–‰</button>
                <button class="m-btn" onclick="closeAI()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <div id="input-modal" class="modal">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h3 id="modal-date-title" style="margin:0;"></h3>
                <div id="modal-weather-info" style="color:var(--accent-blue); font-weight:900;"></div>
            </div>
            <div id="time-picker"></div>
            <div style="display: flex; gap: 8px; margin-bottom: 12px; height: 140px;">
                <div id="color-palette" style="display: grid; grid-template-columns: repeat(3, 1fr); width: 85px; gap: 4px;"></div>
                <div style="flex:1; display:flex; flex-direction:column;">
                    <textarea id="ev-name" style="flex:1; background:#000; border:1px solid #333; color:#fff; padding:10px; border-radius:8px; resize:none;" placeholder="ë‚´ìš© ì…ë ¥..."></textarea>
                    <button class="m-btn" style="width:100%; color:var(--ai-orange); height:32px; font-size:0.75rem; margin-top:4px;" onclick="activateStampMode()">COPY ALL (STAMP)</button>
                </div>
                <div class="function-btns" style="display:flex; flex-direction:column; gap:4px; width:100px;">
                    <button class="f-btn" onclick="openAI()" style="color:var(--ai-orange) !important; height:45px;">AI ë¹„ì„œ</button>
                    <button id="loc-set-btn" class="f-btn" onclick="openMap()" style="height:45px;">LOC SET</button>
                    <button id="directions-btn" class="f-btn" onclick="goDirections()" style="color:#5AC8FA !important; height:45px;">GET DIR</button>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px;">
                <button onclick="closeModal()" class="m-btn" style="background:none;">CLOSE</button>
                <button id="mode-add" onclick="handleModeBtn('add')" class="m-btn">ADD</button>
                <button id="mode-edit" onclick="handleModeBtn('edit')" class="m-btn">EDIT</button>
                <button id="mode-del" onclick="handleModeBtn('del')" class="m-btn">DEL</button>
            </div>
        </div>
    </div>

    <div id="map-overlay"><div id="map-container" style="height:80%; border-radius:12px;"></div><button class="m-btn" style="width:100%; margin-top:10px;" onclick="confirmMapLocation()">CONFIRM</button></div>

    <script>
        const storageKeyPrefix = 'smart_v24h_'; 
        let viewDate = new Date(2026, 0, 1);
        let currentDay = 0, startSlot = null, endSlot = null, selectedColor = '#0070FF', editingIdx = -1, currentMode = 'add';
        let memoEvents = [], memoCoords = null, memoAddr = "", isStampMode = false;
        const weatherMap = { 0: "â˜€ï¸", 1: "ğŸŒ¤ï¸", 2: "â›…", 3: "â˜ï¸", 45: "ğŸŒ«ï¸", 51: "ğŸŒ¦ï¸", 61: "ğŸŒ§ï¸", 71: "â„ï¸", 95: "â›ˆï¸" };
        let globalLastCoords = { lat: 37.4979, lng: 127.0276 }; let globalLastAddr = "ê°•ë‚¨êµ¬"; let defaultWeather = null;

        function getStore() { const key = storageKeyPrefix + viewDate.getFullYear() + '_' + (viewDate.getMonth() + 1); return { key, data: JSON.parse(localStorage.getItem(key) || '{}') }; }

        // [24ì‹œê°„ ì§€ëŠ¥í˜• ë¹„ì„œ ì—”ì§„]
        async function processAICommand() {
            const cmd = document.getElementById('ai-command').value;
            if(!cmd) return;
            const days = {"ì¼":0, "ì›”":1, "í™”":2, "ìˆ˜":3, "ëª©":4, "ê¸ˆ":5, "í† ":6};
            let targetDayNum = -1;
            for(let key in days) { if(cmd.includes(key)) targetDayNum = days[key]; }

            function parseHour(text) {
                let h = 0;
                const match = text.match(/(\d+)ì‹œ/);
                if(!match) return null;
                h = parseInt(match[1]);
                if(text.includes("ì˜¤í›„") && h < 12) h += 12;
                if(text.includes("ì˜¤ì „") && h === 12) h = 0;
                return h;
            }

            const parts = cmd.split("ë¶€í„°");
            let sH = 0, eH = 0;
            if(parts.length > 1) {
                sH = parseHour(parts[0]);
                eH = parseHour(parts[1]);
            }

            if(targetDayNum !== -1 && sH !== null && eH !== null) {
                const { key, data } = getStore();
                const lastD = new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 0).getDate();
                const name = cmd.split("ìš”ì¼")[1]?.replace(/ì˜¤ì „|ì˜¤í›„|ë¶€í„°|ê¹Œì§€|\d+ì‹œ/g, "").trim() || "AI ì¼ì •";
                
                for(let d=1; d<=lastD; d++) {
                    if(new Date(viewDate.getFullYear(), viewDate.getMonth(), d).getDay() === targetDayNum) {
                        if(!data[d]) data[d] = { events: [], weather: { ...defaultWeather, coords: globalLastCoords, addr: globalLastAddr } };
                        data[d].events.push({ name, start: sH, end: eH, color: "#AF52DE" });
                    }
                }
                localStorage.setItem(key, JSON.stringify(data));
                renderCalendar();
                alert(`${sH}ì‹œ~${eH}ì‹œ ì¼ê´„ ë“±ë¡ ì™„ë£Œ!`);
                closeAI();
            }
        }

        function openAI() { closeModal(); document.getElementById('ai-modal').style.display = 'flex'; }
        function closeAI() { document.getElementById('ai-modal').style.display = 'none'; }

        function renderCalendar() {
            const { data } = getStore(); const container = document.getElementById('main-calendar');
            const year = viewDate.getFullYear(), month = viewDate.getMonth();
            document.getElementById('year-title').innerText = `${year}. ${(month+1).toString().padStart(2,'0')}`;
            let html = '';
            ['SUN','MON','TUE','WED','THU','FRI','SAT'].forEach((d,i)=> html += `<div class="cal-header" style="color:${i===0?'#ff4d4d':i===6?'#4da6ff':'#888'}">${d}</div>`);
            const first = new Date(year, month, 1).getDay(); const last = new Date(year, month+1, 0).getDate();
            for(let i=0; i<first; i++) html += `<div class="cal-day prev-month"></div>`;
            for(let d=1; d<=last; d++) {
                const dD = data[d] || { events: [], weather: {} };
                // 24ê°œ íƒ€ì„ë°” ë Œë”ë§
                let bH = Array(24).fill(0).map((_,i)=>{ const ev = dD.events.find(e => i>=e.start && i<e.end); return `<div style="background:${ev?ev.color:'#151515'}"></div>`; }).join('');
                let w = dD.weather || {};
                let wH = w.temp ? `<div class="weather-badge-main"><div class="w-line"><span style="color:#fff;">${w.min}/${w.max}</span></div><div class="w-line" style="color:var(--accent-blue);"><span class="w-loc-inline">${w.addr.substring(0,3)}</span><span>${w.icon}</span></div></div>` : "";
                html += `<div class="cal-day" onclick="handleDayAction(${d})"><div class="day-num">${d}</div>${wH}<div class="time-bar">${bH}</div></div>`;
            }
            container.innerHTML = html; container.style.gridTemplateRows = `18px repeat(6, 1fr)`;
        }

        function initTime() {
            const t = document.getElementById('time-picker'); t.innerHTML = '';
            for(let i=0; i<24; i++) {
                const b = document.createElement('div'); b.innerText = i; b.style.padding = '5px 0'; b.style.textAlign = 'center'; b.style.fontSize = '0.65rem'; b.style.background = '#1a1a1a'; b.style.border = '1px solid #333'; b.style.cursor = 'pointer';
                b.onclick = () => { if(startSlot === null || (startSlot !== null && endSlot !== null)) { startSlot = i; endSlot = null; } else { endSlot = i; } updateTimeUI(); };
                t.appendChild(b);
            }
        }
        function updateTimeUI() {
            const btns = document.querySelectorAll('#time-picker div');
            btns.forEach((b, i) => { 
                const s = Math.min(startSlot, endSlot === null ? startSlot : endSlot);
                const e = Math.max(startSlot, endSlot === null ? startSlot : endSlot);
                b.style.background = (startSlot !== null && i >= s && i <= e) ? selectedColor : '#1a1a1a';
            });
        }
        // [ê¸°ì¡´ í•¨ìˆ˜ë“¤ ìœ ì§€...]
        function handleDayAction(d) { if(isStampMode) executeStampPaste(d); else openModal(d); }
        async function executeStampPaste(d) { /* ...ì—°ì†ë„ì¥ ë¡œì§... */ }
        function activateStampMode() { isStampMode = true; document.body.classList.add('stamp-mode-active'); closeModal(); }
        function deactivateStampMode() { isStampMode = false; document.body.classList.remove('stamp-mode-active'); }
        window.openModal = function(d) { currentDay = d; document.getElementById('modal-date-title').innerText = `${viewDate.getMonth()+1}.${d}`; document.getElementById('input-modal').style.display = 'flex'; startSlot = null; endSlot = null; initTime(); initPalette(); };
        function closeModal() { document.getElementById('input-modal').style.display = 'none'; }
        function handleModeBtn(m) { if(m==='add' && startSlot!==null) { const {key,data}=getStore(); if(!data[currentDay]) data[currentDay]={events:[],weather:{}}; data[currentDay].events.push({name:document.getElementById('ev-name').value, start:Math.min(startSlot,endSlot), end:Math.max(startSlot,endSlot), color:selectedColor}); localStorage.setItem(key,JSON.stringify(data)); renderCalendar(); closeModal(); } }
        function initPalette() { const p = document.getElementById('color-palette'); p.innerHTML = ''; ['#0070FF','#FF3B30','#34C759','#FFCC00','#AF52DE','#FF9500'].forEach(c=>{ const d=document.createElement('div'); d.style.background=c; d.style.height='30px'; d.style.borderRadius='4px'; d.onclick=()=>{selectedColor=c; initPalette();}; p.appendChild(d); }); }
        function changeMonth(diff) { viewDate.setMonth(viewDate.getMonth()+diff); renderCalendar(); }
        function openMap() { document.getElementById('map-overlay').style.display='flex'; }
        function confirmMapLocation() { document.getElementById('map-overlay').style.display='none'; }
        window.onload = renderCalendar;
    </script>
</body>
</html>